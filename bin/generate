#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use OomphInc\FAST_WP\YamlTransformer;

//get input (or env variables)
$theme_root = getenv( 'THEME_ROOT' );
$config_input = getenv( 'CONFIG_INPUT' );
$config_output = getenv( 'CONFIG_OUTPUT' );

$yaml_string = file_get_contents($config_input);

if ($yaml_string === false) {
	echo "Error reading file $config_input\n";
	exit(1);
}

$transformer = new YamlTransformer($yaml_string);

foreach (get_class_methods('OomphInc\\FAST_WP\\BasicHandlers') as $handler) {
	$transformer->add_handler($handler, 'fast_wp_' . $handler, ['OomphInc\\FAST_WP\\BasicHandlers', $handler]);
}

$compiled = $transformer->execute();
// @todo: lint the file!
//file_put_contents("{$theme_root}/{$config_output}", $compiled);
echo $compiled;
